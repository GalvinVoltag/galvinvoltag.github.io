(()=>{"use strict";const e=new class{constructor(){this.toLoad={ph:"./public/images/placeholder_spritesheet.png",tennasheet:"./public/images/TennaFullMap.png",playersheet:"./public/images/combined_spritesheet.png"},this.images={},Object.keys(this.toLoad).forEach(e=>{const t=new Image;t.src=this.toLoad[e],this.images[e]={image:t,isLoaded:!1},t.onload=()=>{this.images[e].isLoaded=!0}})}};class t{constructor(e,t,s="#000000FF",n=30,r=new i){this.keys={},this.ctx=t,this.bg_color=s,this.fps=n,this.layers={},this.timeScales={0:1},this.lastUpdate=Date.now(),this.cameraPos=new a,this.areas={def:r},this.currentArea=this.areas.def,this.gameElement=e,this.enabled=!0}GameLoop(){if(!this.enabled)return;var e=Date.now(),t=(e-this.lastUpdate)/100;this.lastUpdate=e,this.ctx.rect(0,0,this.ctx.canvas.clientWidth,this.ctx.canvas.clientHeight),this.ctx.fillStyle=this.bg_color,this.ctx.fill(),this.cameraPos=this.currentArea.limit(this.cameraPos),this.ctx.setTransform(1,0,0,1,Math.round(this.ctx.canvas.clientWidth/5-this.cameraPos.x),Math.round(this.ctx.canvas.clientHeight/5-this.cameraPos.y));let i=[];Object.keys(this.layers).concat(Object.keys(this.currentArea.layers)).forEach(e=>{let s=+e;if(i.includes(s))return;let n=[];n=null!=this.layers[s]&&null!=this.currentArea.layers[s]?this.layers[s].concat(this.currentArea.layers[s]):null==this.currentArea.layers[s]?this.layers[s]:this.currentArea.layers[s],n.forEach(e=>{let i=this.timeScales[0];Object.hasOwn(this.timeScales,s)&&(i=this.timeScales[s]),e.Update&&e.Update(t*i),e.LateUpdate&&e.LateUpdate(t*i),e.Draw&&e.Draw(this.ctx,t*i)}),i.push(s)})}SetTimeScale(e,t){this.timeScales[e]=t}ClearTimeScale(e){0==e?this.timeScales[0]=1:Object.hasOwn(this.timeScales,e)&&delete this.timeScales[e]}AddArea(e,t=new i){this.areas[e]=t}SetArea(e){e in this.areas&&(this.currentArea=this.areas[e])}Register(e,t=0){t in this.layers||(this.layers[t]=[]),this.layers[t].push(e)}UnRegister(e){for(const t of Object.values(this.layers)){const i=t.indexOf(e);if(i>-1)return t.splice(i,1),!0}return!1}SetLayer(e,t){return!!this.UnRegister(e)&&(this.Register(e,t),!0)}Start(){document.addEventListener("keydown",e=>{document.activeElement==document.getElementById(this.gameElement.id)&&(e.preventDefault(),this.keys[e.key]=!0)}),document.addEventListener("keyup",e=>{this.keys[e.key]=!1}),setInterval(()=>this.GameLoop(),1e3/this.fps)}KeyDown(e){return this.keys[e]}}class i{constructor(e=new r,t=new a){this.Rect=e,this.Origin=t,this.layers={}}limit(e){var t=new a(e.x,e.y);let i=this.Rect.GetRectOrigin(this.Origin);return e.x>i.Right?t.x=i.Right:e.x<i.Left&&(t.x=i.Left),e.y>i.Bottom?t.y=i.Bottom:e.y<i.Top&&(t.y=i.Top),t}Register(e,t=0){t in this.layers||(this.layers[t]=[]),this.layers[t].push(e)}UnRegister(e){for(const t of Object.values(this.layers)){const i=t.indexOf(e);if(i>-1)return t.splice(i,1),!0}return!1}SetLayer(e,t){return!!this.UnRegister(e)&&(this.Register(e,t),!0)}}class s{constructor(e,t,i=4,s={up:"ArrowUp",down:"ArrowDown",right:"ArrowRight",left:"ArrowLeft",interact:"Z",cancel:"X",menu:"C"}){this.sprite=t,this.position=t.position,this.speed=i,this.controls=s,this.game=e}GetAxis(e,t){return e&&t?0:t?-1:e?1:0}Update(e){let t=this.GetAxis(this.game.KeyDown("ArrowRight"),this.game.KeyDown("ArrowLeft"))*e*this.speed,i=this.GetAxis(this.game.KeyDown("ArrowDown"),this.game.KeyDown("ArrowUp"))*e*this.speed;this.position.x+=t,this.position.y+=i,this.game.cameraPos=this.position,i<0?this.sprite.setanimation("walk_up"):i>0?this.sprite.setanimation("walk_down"):t<0?this.sprite.setanimation("walk_left"):t>0?this.sprite.setanimation("walk_right"):this.sprite.clearanimation()}Draw(e,t){this.sprite.position=this.position,this.sprite.DrawAt(e,t,this.position)}}class n{constructor({resource:e,frameSize:t,frames:i,frame:s,scale:n,position:r,origin:h,currentAnimation:o,animations:l}){this.resource=e,this.frameSize=null!=t?t:new a(this.resource.image.width,this.resource.image.height),this.frames=null!=i?i:{0:new a},this.frame=null!=s?s:0,this.scale=null!=n?n:new a(1,1),this.position=null!=r?r:new a,this.origin=new a(.5,.5),this.animations=null!=l?l:{},this.currentAnimation=null!=o?o:null,this.animationTime=0}setanimation(e,t=!1){Object.hasOwn(this.animations,e)&&(this.currentAnimation=e),t&&(this.animationTime=0)}clearanimation(e=!1){this.currentAnimation=null,e&&(this.animationTime=0)}DrawAt(e,t=0,i){this.resource.isLoaded&&(null!=this.currentAnimation&&(Math.floor(this.animationTime*this.animations[this.currentAnimation].speed)>=this.animations[this.currentAnimation].frames.length&&(this.animationTime=0),this.frame=this.animations[this.currentAnimation].frames[Math.floor(this.animationTime*this.animations[this.currentAnimation].speed)],this.animationTime+=t),e.drawImage(this.resource.image,this.frames[this.frame].x,this.frames[this.frame].y,this.frameSize.x,this.frameSize.y,Math.round(i.x-this.origin.x*this.frameSize.x),Math.round(i.y-this.origin.y*this.frameSize.y),this.scale.x*this.frameSize.x,this.scale.y*this.frameSize.y))}Draw(e,t=0){this.resource.isLoaded&&(null!=this.currentAnimation&&(Math.floor(this.animationTime*this.animations[this.currentAnimation].speed)>=Object.keys(this.animations[this.currentAnimation].frames).length&&(this.animationTime=0),this.frame=this.animations[this.currentAnimation].frames[Math.floor(this.animationTime*this.animations[this.currentAnimation].speed)],this.animationTime+=t),e.drawImage(this.resource.image,this.frames[this.frame].x,this.frames[this.frame].y,this.frameSize.x,this.frameSize.y,Math.round(this.position.x-this.origin.x*this.frameSize.x),Math.round(this.position.y-this.origin.y*this.frameSize.y),this.scale.x*this.frameSize.x,this.scale.y*this.frameSize.y))}}class a{constructor(e=0,t=0){this.x=null!=e?e:0,this.y=null!=t?t:0}Add(e){return e instanceof a?new a(this.x+e.x,this.y+e.y):new a(this.x+e,this.y+e)}Mul(e){return e instanceof a?new a(this.x*e.x,this.y*e.y):new a(this.x*e,this.y*e)}Div(e){return e instanceof a?new a(this.x/e.x,this.y/e.y):new a(this.x/e,this.y/e)}Neg(){return new a(-this.x,-this.y)}}class r{constructor(e=0,t=0,i=0,s=0){this.A=new a(e,s),this.B=new a(t,i)}GetRect(){return{Left:this.A.x,Right:this.B.x,Top:this.A.y,Bottom:this.B.y}}GetRectOrigin(e){return{Left:e.x+this.A.x,Right:e.x+this.B.x,Top:e.y+this.A.y,Bottom:e.y+this.B.y}}}class h{constructor(e=[],t=1){this.frames=e,this.speed=t}}document.querySelectorAll(".tablink").forEach(e=>{e.addEventListener("click",function(){var e,t,i;for(t=document.getElementsByClassName("tab_container"),i=document.getElementsByClassName("tablink"),e=0;e<t.length;e++)t[e].classList.add("hidden");for(e=0;e<i.length;e++)i[e].classList.remove("tablink_active");document.getElementById(this.id).classList.add("tablink_active"),document.getElementById("tab"+this.id).classList.remove("hidden"),o.enabled=!1,l.enabled=!1;var s=document.getElementById("tab"+this.id).querySelector(".game-screen canvas");document.getElementById("tab"+this.id).querySelector(".game-screen").id,o.enabled=!0,l.enabled=!0,s.getContext("2d")},!1)}),document.querySelector(".game-screen canvas").getContext("2d");var o=new t(document.querySelector("#game-legend"),document.querySelector("#game-legend canvas").getContext("2d"),"#00FF00FF",30,new i(new r(0,0,100,-100),new a(0,0))),l=new t(document.querySelector("#game-bunker"),document.querySelector("#game-bunker canvas").getContext("2d"),"#0000BBFF",30,new i);o.Start(),o.fps=30,o.areas.def.Register(new n({resource:e.images.ph,position:new a(0,60),origin:new a,animationTime:0,frameSize:new a(16,16),scale:new a(1,1),frames:{0:new a(1,11),1:new a(18,11),2:new a(35,11),3:new a(52,11),4:new a(69,11),5:new a(86,11),6:new a(103,11),7:new a(120,11)},frame:0,animations:{walk_down:new h([0,1],.3),walk_up:new h([2,3],.3),walk_left:new h([4,5],.3),walk_right:new h([6,7],.3)},currentAnimation:null})),o.Register(new class{constructor(e,t=new a,i=[]){this.sprite=e,this.tiles=i,this.position=t}Draw(e,t){for(let i=0;i<this.tiles.length;i++)for(let s=0;s<this.tiles[i].length;s++)this.sprite.frame=this.tiles[i][s],this.sprite.DrawAt(e,t,new a(this.position.x+s*this.sprite.frameSize.x,this.position.y+i*this.sprite.frameSize.y))}}(new n({resource:e.images.tennasheet,position:new a,origin:new a,animationTime:0,frameSize:new a(16,16),scale:new a(1,1),frames:{0:new a(162,259),1:new a(18,11),2:new a(35,11),3:new a(52,11),4:new a(69,11),5:new a(86,11),6:new a(103,11),7:new a(120,11)},frame:0,animations:{walk_down:new h([0,1],.3),walk_up:new h([2,3],.3),walk_left:new h([4,5],.3),walk_right:new h([6,7],.3)},currentAnimation:null}),new a(0,0),[[0,0,0],[3,3,3],[4,4,4,4]]),0),o.Register(new s(o,new n({resource:e.images.ph,position:new a,origin:new a,animationTime:0,frameSize:new a(16,16),scale:new a(1,1),frames:{0:new a(1,11),1:new a(18,11),2:new a(35,11),3:new a(52,11),4:new a(69,11),5:new a(86,11),6:new a(103,11),7:new a(120,11)},frame:0,animations:{walk_down:new h([0,1],.3),walk_up:new h([2,3],.3),walk_left:new h([4,5],.3),walk_right:new h([6,7],.3)},currentAnimation:null}),4)),l.Start(),l.enabled=!1,l.Register(new s(l,new n({resource:e.images.playersheet,position:new a,origin:new a,animationTime:0,frameSize:new a(16,16),scale:new a(1,1),frames:{0:new a(1,11),1:new a(18,11),2:new a(35,11),3:new a(52,11),4:new a(69,11),5:new a(86,11),6:new a(103,11),7:new a(120,11),8:new a(1,42)},frame:0,animations:{walk_down:new h([0,8,1,8],.3),walk_up:new h([2,3],.3),walk_left:new h([4,5],.3),walk_right:new h([6,7],.3)},currentAnimation:null}),4))})();