
const database = {
  "limit team": { "direct": "limit" },
  "l.i.m.i.t team": { "direct": "limit" },
  "l.i.m.i.t": { "direct": "limit" },
  "limit": {
    "prefix": "[boxcolor:blue]",
    "date": "2 Nissan 1884",
    "entry": `[color:cyan]
              L.I.M.I.T (aka) Limited Interdimensional Machine of Intelligence Terminal, is an 
              open source project lead by the LIMIT team for the sole purpose of reducing the 
              need for information for those who are in an unstable reality. <br><br>
              The LIMIT Team operates in stable realities, documenting information that may, will, 
              or is leaking to the outside. They usually wear their black suits and prefer to operate
              undetected by the residents of stable realities. `,
  },
  "dead pumpkin head": {
    "prefix": "[boxcolor:orange]",
    "date": "12 Nexus 1865",
    "entry": `[color:orange]
    The Dead Pumpkin Head is a punpkin head from the Late Night Knight Wall town. He is a well known
    and feared mafia boss who prefers to deal with the problems himself, rather than assigning someone.
    His most identifying features are his purple suit, punpkin head, revolver, and magic. His most
    favorite magic is seemingly fire and soul magic, as he is seen keeping his favorite souls trapped 
    in jars in the trunk of his car. He never speaks besides short evil laughters such as "ah hah hah"
    or "ha ha ha"
    
    `
  },
  "universe classification": {
    "prefix": "[boxcolor:cyan]",
    "date": "33 Neumann 1978",
    "entry": `[color: cyan]
              LIMIT team has a standardized system of assigning universes and smaller realities
              unique identity strings, called universe IDs. The rules are as follows. [wait] <br> <br>
              1. Universe/Reality Class: this character identifies the type of Universe/Reality. <br>
              . 1.1. "Ω" identifies Universes with residents. These universes are in some places hospitable.
              Their ages are usually in between 13 billion and 63 billion years. <br>
              . 1.2. "Δ" identifies uninhabited Universes. These universes are hostile to all life and are 
              usually too young to ever evolve one. Most of them are younger than 12 billion years. <br>
              . 1.3. "-Δ" identigies no longer uninhabited Universes that are too old to ever evolve life
              ever again in their lifetime. This usually identifies Universes older than 70 billion years old. <br>
              . 1.4. "Σ" identifies Universes that are themselves artificial, or artificially maintained. They
              are usually inhabited by residents but an autonomous system could theoretically sustain a Universe
              too. These universes are usually fighting against instability, diseases or old age. <br>
              . 1.5. "Φ" identifies dead, uninhabited and hostile universes. These universes are either died by
              natural causes, old age, diseases, or have been murdered. These universes have increasing instability
              and are not suitable for any contact including fly-by.<br>
              2. Quantum Signature: this section is marked with the "Q" character, and identifies the quantum fingerprint
              of the universe. All quantum phenomena originating from a universe always obeys to collapse
              functions associated with these two numbers. For those who understand, these numbers are coordinates
              in hypertemporal axes that point to the collapse patterns of quantum phenomena. As it is the law, 
              point intersection of these two numbers in monotemporal space gives out the required mass/energy*volume
              for an object to exist as macroscophic objects, that obey individual laws of physics. <br>
              3. Universal Constant: this number is marked with the "G" character, and identifies the Universal
              Constant. It may help to calculate the gravitational forces, vacumm forces, dark energy constant, and
              dark matter composition depending on the dominant laws of physics. The first part is negative power
              of ten, and the secon is the number with decimal point erased. <br>
              4. Revision Count: the number of resets the Universe has gone through. This number usually doesn't exist
              due to the rarity of this phenomena. As this number goes up, the amount of angelic force decreases 
              in a Universe. <br> <br>
              Example ID: "Ω.Q·A7F2.3B91.G·25ε065"
              `
  },
  "universe id number": { "direct": "universe id" },
  "universe id": {
    "prefix": "[boxcolor:cyan]",
    "date": "15 Tishrei 1991",
    "entry": `[color:#ff8800]
              Transportation infrastructure utilizing non-Euclidean geometry to compress 
              travel distances. Vehicles enter hyperbolic space through stabilized rifts, 
              reducing 500km journeys to approximately 12km subjective distance. 
              Side effects include minor temporal displacement (±3 minutes) and occasional 
              [color:#ff0000]reality bleed-through from adjacent universes.`,
  },
  
  "reality bleed": {
    "prefix": "[boxcolor:orange]",
    "universeid": "ΩQ·CORE.0001·ΦALERT·R0",
    "date": "1 Tevet 1988",
    "entry": `[color:#ff0000]
              ALERT LEVEL: HIGH · Phenomenon where unstable universe boundaries allow 
              matter, energy, or information to leak between parallel realities. 
              Symptoms include: objects with impossible properties, memories of events 
              that never occurred, and visual distortions. [color:#ffff00]If experiencing 
              reality bleed, immediately query LIMIT for local stabilization protocols.`,
  },
  
  "quantum anchor": {
    "prefix": "[boxcolor:yellow]",
    "universeid": "ΩQ·5B82.9156·Φ44ε673m1·R2",
    "date": "22 Iyar 1989",
    "entry": `[color:#00ff00]
              Device that stabilizes local spacetime by establishing a fixed quantum 
              reference point. Essential equipment for LIMIT field agents operating in 
              unstable realities. Generates a 50-meter sphere of normalized causality. 
              Battery life: 72 hours. [color:#ff8800]WARNING: Do not operate near 
              hyperbolic highways or active rifts.`,
  },
  
  "temporal displacement": {
    "prefix": "[boxcolor:orange]",
    "universeid": "ΩQ·3C94.4521·Φ67ε881p9·R3",
    "date": "18 Elul 1990",
    "entry": `[color:#ff00ff]
              Minor time desynchronization caused by interdimensional travel or exposure 
              to reality bleeds. Typically ranges from seconds to hours. Subjects report 
              "arriving before they left" or experiencing duplicate moments. [color:#00ffff]
              Chronic displacement can lead to causality fragmentation - seek LIMIT 
              medical immediately if symptoms persist beyond 48 hours.`,
  },
  
  "causality fragmentation": {
    "prefix": "[boxcolor:orange]",
    "universeid": "ΩQ·CORE.0003·ΦALERT·R0",
    "date": "30 Shevat 1992",
    "entry": `[color:#ff0000]
              CRITICAL CONDITION · Occurs when an individual's personal timeline becomes 
              unstable due to repeated temporal displacement or severe reality bleed exposure. 
              Symptoms: [color:#ff8800]memory loops, experiencing multiple presents 
              simultaneously, gradual erasure from causal history. [color:#ff0000]
              SURVIVAL RATE: 23% · Requires immediate quantum anchor attachment and 
              timeline reconstruction.`,
  },

  "help": {
    "prefix": "[boxcolor:blue]",
    "date": "1 Nissan 1887",
    "entry": `[color:#00ffff] [speed:10]
              AVAILABLE COMMANDS: <br>
              · lim - Information about L.I.M.I.T system <br> [wait:6]
              · hyperbolic highway - Non-Euclidean transport tech <br> [wait:6]
              · reality bleed - Universe boundary instability <br> [wait:6]
              · quantum anchor - Spacetime stabilization device <br> [wait:6]
              · limit team - About the field operatives <br> [wait:6]
              · temporal displacement - Time desynchronization <br> [wait:6]
              · causality fragmentation - Critical timeline instability <br> [wait:6]
              <br> [wait:3] [speed:1]
              [color:#ffff00]Type any query to search the database.`,
  },
  "gerson berries": {
    "prefix": "[boxcolor:green]",
    "date": "1 Nissan 1887",
    "entry": `[color:lightgreen] [speed:10]
              Gerson Berries are fruits, usually frowing on Ceilinus Lampus, a plant that grows in low
              air pressures and high temperatures, such as 0.1 atm and 400 degrees celcius.`,
  },
  "hostile territory": {"direct": "ωq·core.0001·φalert·r0"},
  "ωq·core.0001·φalert·r0": {
    "prefix": "[boxcolor:yellow] UNIVERSE TITLE: Hostile Territory <br>",
    "date": "13 Centaurus 1889",
    "entry": `[speed:10]
              This universe is pretty early in its life so most of it is
              inhabitable.`,
  },
};

setInterval(() => GlobalUpdate(), 1000 / 24);

var requestedText = `
Welcome to the L.I.M.I.T <br>
last update: 2 Fermi 1887 - 13 A.M.
<br><br>
We are here to provide information to those who suffer from universal instability.
`;
var inputAllowed = true;
var queryNumber = 0;
var contentNumber = 0;
var color = "#ffff00";
var borderColor = "#ffff00";
var resetColorPerContent = true;
var resetColorPerQuery = true;
var skipstart = 0;
var skipend = 0;
var skip = false;
var waitTime = 0;
var maxLettersPerFrame = 24;

function PartialParseNumber(wholeText) {
  var i = 0;
  var b = false;
  var loopDetect = 0;
  while ((![" ", "·"].includes(wholeText[i]) || b) && i < wholeText.length && i < maxLettersPerFrame && loopDetect < 50) {
    loopDetect+=1;
    if (wholeText[i] == "<") {
      i += wholeText.substring(i).indexOf(">")+1;
      // console.log(wholeText[i]);
      continue;
    }
    if (wholeText[i] == "[") {
      skipstart = i;
      let index = wholeText.indexOf("]");
      RunCommand(wholeText.substring(i, index - i + 1));
      skipend = i+index;
      // i+=1;
      skip = true;
      break;
    }
    i+=1;
  }
  while ([" ", "·", "."].includes(wholeText[i+1]) && i < wholeText.length && i < 10) {
    i+=1;
  }
  return i+1;
}

function RunCommand(text) {
  if (text[0]=="[") {
    var command;
    var input;
    if (text.indexOf(":") == -1) {
      command = text.substring(1, text.length-1);
    } else {
      command = text.substring(1, text.indexOf(":"));
      input = text.substring(text.indexOf(":")+1, text.indexOf("]"));
    }
    console.log(command + ":" + input + "   <--" + text);
    if (command == "color") 
    {
      if (input) color = input;
      else color = "#ffff00";
      contentNumber+=1;
      document.querySelector('#out'+queryNumber).innerHTML += 
      `<p id="con${contentNumber}" class="crt-glow crt-text" style="--color:${color};"></p>`;
    } 
    else if (command == "wait") 
    {
      if (input) waitTime += Number(input);
      else waitTime += 10;
      console.log("will wait" + waitTime);
    } 
    else if (command == "boxcolor" || command == "bordercolor") 
    {
      if (input) borderColor = input;
      else borderColor = "#ffff00";
      document.getElementById('out' + queryNumber).style.setProperty('--color', borderColor);
    }
    else if (command == "speed") 
    {
      if (input) maxLettersPerFrame = Number(input);
      else maxLettersPerFrame = 24;
    }
  }
}

function GlobalUpdate() {
  if (waitTime > 0) {
    waitTime -= 1;
    return;
  }
  // console.log(requestedText);
  if (requestedText) {
    if (inputAllowed) {
      queryNumber+=1;
      console.log(queryNumber);
      document.querySelector('#output').innerHTML += 
      `<div id="out${queryNumber}" class="crt-outline" style="--color:${borderColor}">
      <p id="con${contentNumber}" class="crt-glow crt-text" style="--color:${color};"></p>
      </div>`;
      inputAllowed = false;
      document.getElementById("input").style.setProperty("--color", "#ff8800");
    }
    let cutLength = PartialParseNumber(requestedText);
    if (skip) {
      requestedText = requestedText.slice(0, skipstart) + requestedText.slice(skipend+1);
      skip = false;
      skipstart = 0;
      skipend = 0;
    }
    if (waitTime > 0) return;
    document.querySelector('#out' + queryNumber).querySelector('#con' + contentNumber).innerHTML += requestedText.substring(0, cutLength);
    requestedText = requestedText.slice(cutLength);
    window.scrollTo(0, document.body.scrollHeight);
  } else {
    if (inputAllowed==false && resetColorPerContent) {
        color = "#ffff00";
    }
    if (inputAllowed==false && resetColorPerQuery) {
      borderColor = "#ffff00";
    }
    inputAllowed = true;
    document.getElementById("input").style.setProperty("--color", "#ffff00");
  }
}

document.querySelector('#input').addEventListener('keydown', function(event) {
  if (event.key === 'Enter' && inputAllowed) {
    
    const inputText = event.target.value.toLowerCase();

    var htmlValue = "";
    if (inputText == "list all entries") {
      htmlValue += `  ALL AVAILABLE ENTRIES <br> -------------------------- <br>`;
      for (const [key, value] of Object.entries(database)) {
        if (!value["direct"])
          htmlValue += `${key} <br>`
      }
    }
    else if (database[inputText]) {
      var entry = inputText;
      if (database[inputText]["direct"])
        entry = database[inputText]["direct"]; 

      if (database[entry]["prefix"])
        htmlValue += `${database[entry]["prefix"]}`
      htmlValue += `UPDATED: [speed:1]    ${database[entry]["date"]} <br> [wait]`
      if (database[entry]["universeid"])
        htmlValue += `UNIVERSE ID: ${database[entry]["universeid"]} <br> [wait]`
      htmlValue += `
      <br>
      ENTRY:<br> [wait] [speed]
      ${database[entry]["entry"]}
      `;
    } else {
      htmlValue = `[color:#ff2424]
      [boxcolor:#ff2424]  UNKNOWN QUERY: "${inputText}"
      `;
    }
    
    
    requestedText = htmlValue;
    
      // requestedText = `<div>Command not found: ${inputText}</div>`;
    

    // window.scrollTo(0, document.body.scrollHeight - height*1.8);

    document.querySelector(".scroller").innerHTML

    event.target.value = '';
    
  }

})